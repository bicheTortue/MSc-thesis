\section{The activation functions}
\label{sec:af}

Activation functions play a great role in the results obtained \cite{af}. It is the reason why making good activation function circuits is fundamental. Of course the easy way would be to simply design a hard sigmoid (\cref{apsec:hardFunc}), the issue being that the hard sigmoid is much worse than the regular sigmoid, especially for regression problems \cite{hardSigm}. The same goes for the \ac{tanh} and hard \ac{tanh} functions.

Designing an analog activation function as close to the original is very important for the final result's quality.

\subsection{Circuit}

The circuit used is the same as the one in \cite{thesisRef}, the circuit is the one shown in \cref{circt:af}. The technology used being different, all the parameters had to be determined empirically to best fit a sigmoid shape. The parameters can be found in \cref{tab:afPar}.

Due to the nature of the functions we want to generate, we will use the same circuit for both a sigmoid and a \ac{tanh} like functions. The two different functions are generated by changing two parameters.

The functions generated are the same shape and only differ by their output range.

\begin{figure}[H]
  \centering
  \includesvg[width=\textwidth]{activation/afCircuit}
  \caption{Activation functions circuit}
  \label{circt:af}
\end{figure}

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|c|}
    \hline
    \rowcolor{gray}
    Parameter & Sigmoid & \ac{tanh} \\
    \hline
    $V_1$ & \multicolumn{2}{c|}{$1.1V$}\\
    \hline
    $V_2$ & \multicolumn{2}{c|}{$635mV$}\\
    \hline
    $V_3$ & $0.8V$ & $550mV$\\
    \hline
    $i_{dc}$ & \multicolumn{2}{c|}{$150uA$}\\
    \hline
    $w$ & \multicolumn{2}{c|}{$900nm$}\\
    \hline
    $l$ & \multicolumn{2}{c|}{$60nm$}\\
    \hline
    $R_1$ & \multicolumn{2}{c|}{$5k\Omega$}\\
    \hline
    $R_2$ & \multicolumn{2}{c|}{$10k\Omega$}\\
    \hline
    $R_3$ & $2k\Omega$ & $4k\Omega$\\
    \hline
  \end{tabular}
  \caption{Circuits parameters}
  \label{tab:afPar}
\end{table}

Here, $w$ and $l$ are, respectively, the width and length of the two NMOS of the circuit.

\subsection{Symbols}

The symbols for the sigmoid and the \ac{tanh} are separated for better understanding.

\begin{figure}[H]
  \centering
  \hspace*{0.8cm}
  \subfloat[Sigmoid symbol]{\includesvg[height=2.5cm]{activation/sigmoidSymbol}}%
  \hfill
  \subfloat[\ac{tanh} symbol]{\includesvg[height=2.5cm]{activation/tanhSymbol}}%
  \hspace*{0.8cm}
  \caption{Activation functions symbols with the input and output pins on either side depending on the flow of the current for better readability}
  \label{sym:af}
\end{figure}

The approximate onChip area of this circuit is :

\begin{equation}
  A_{af}=2\cdot A_{R_1} + 2\cdot A_{CMOS} + 5\cdot A_{R_2} + A_{R_3} +2\cdot A_{opAmp}
\end{equation}
With $A_{CMOS} = w\cdot l$

In order to combine the the onChip area of both the sigmoid and \ac{tanh} activation functions, it is assumed that the variation of area taken by the resistor ($R_3$) is negligible compared to the overall active area.

\subsection{Usage}

This circuit outputs a voltage that depends on the input voltage passed on. The relation between the two is shown in \cref{fig:afGraph}. The graph also shows the \ac{RMSE} of each graph compared to the ideal result.

Note that the actual output of the circuit in \cref{circt:af} is inverted arround $V_{cm}$ a circuit such as the one shown in \cref{apsec:sumInv} inverts the the signal to its intended values.

\begin{figure}[H]
  \centering
  \includesvg[width=\textwidth]{activation/afGraph}
  \caption{Input/Output graph of the activation function circuit for both sigmoid and \acs{tanh} functions}
  \label{fig:afGraph}
\end{figure}

These functions are still a bit different from the original functions (especially for the \ac{tanh}). However that does not matter too much as the trainning will be happening with the extracted analog functions, all weights will be set in the circuit. This is the reason why such a difference does not matter. As long as the curves have the similar shape, the result will not be drastically affected.
